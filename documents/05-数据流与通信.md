# 数据流与通信

## 1. 事件驱动架构

- **优先级事件通道**：基于`embassy-rs`异步通道实现，跨服务事件传递，按优先级处理
- **事件生产者**：各服务产生事件并发送到通道，避免直接模块调用
- **事件消费者**：状态管理器接收并分发事件，处理完成后立即触发主CPU休眠

## 2. 共享状态观察

- **Watch模式**：用于频繁更新的只读状态（如当前时间、天气、电量状态），基于`embassy-rs`信号量实现
- **Signal模式**：用于一次性通知（如唤醒信号、OTA触发信号）
- **Mutex保护**：用于需要修改的共享状态（如配置数据），采用`embassy-rs`异步互斥锁，减少阻塞时间

## 3. 看门狗策略

### 看门狗配置
- **ESP32-C6平台**：使用RTC看门狗，超时时间为30秒，由主CPU的状态管理服务喂狗
- **多平台适配**：无硬件看门狗的平台，采用软件看门狗实现核心监控逻辑

### 喂狗策略
- 每次唤醒主CPU执行任务后喂狗
- 看门狗复位后，通过固定分区记录复位状态，重启后优先恢复核心功能
